<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Election Results Map</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        #map {
            max-width: 960px;
            margin: 0 auto;
        }
        .state {
            stroke: #fff;
            stroke-width: 0.5;
        }
        .state.GOP {
            fill: #ff0000;
        }
        .state.Democrat {
            fill: #0000ff;
        }
        .state.Uncalled {
            fill: #808080;
        }
        .state:hover {
            fill-opacity: 0.7;
            cursor: pointer;
        }
        #tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 8px;
            border-radius: 4px;
            pointer-events: none;
            font-size: 12px;
            display: none;
        }
        .summary {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="summary">
        <h2>Election Results</h2>
        <p><strong>Electoral Votes</strong> — Rockefeller: <span id="gop-electoral">0</span>, Gephardt: <span id="dem-electoral">0</span></p>
        <p><strong>Popular Vote</strong> — Rockefeller: <span id="gop-votes">0</span> (<span id="gop-percent">0%</span>), Gephardt: <span id="dem-votes">0</span> (<span id="dem-percent">0%</span>)</p>
        <p><strong>Reporting:</strong> <span id="reporting">0%</span></p>
    </div>
    <div id="map"></div>
    <div id="tooltip"></div>

    <script>
        // Load GeoJSON (assumed to be in the same directory as index.html)
        d3.json("base-states-with-results.geojson").then(function(geojson) {
            // Set up SVG dimensions
            const width = 960;
            const height = 600;

            // Create SVG container
            const svg = d3.select("#map")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            // Define projection (Albers USA for US states, including Puerto Rico)
            const projection = d3.geoAlbersUsa()
                .scale(1000)
                .translate([width / 2, height / 2]);

            const path = d3.geoPath().projection(projection);

            // Calculate vote totals
            let gopElectoral = 0, demElectoral = 0, gopVotes = 0, demVotes = 0, totalVotes = 0;
            geojson.features.forEach(feature => {
                const props = feature.properties;
                if (props.winner === "Jay Rockefeller") {
                    gopElectoral += props.electoral_votes || 0;
                    gopVotes += props.votes_gop || 0;
                } else if (props.winner === "Democrat") {
                    demElectoral += props.electoral_votes || 0;
                    demVotes += props.votes_dem || 0;
                }
                totalVotes += props.total_votes || 0;
            });

            // Update summary
            d3.select("#gop-electoral").text(gopElectoral);
            d3.select("#dem-electoral").text(demElectoral);
            d3.select("#gop-votes").text(gopVotes.toLocaleString());
            d3.select("#dem-votes").text(demVotes.toLocaleString());
            d3.select("#gop-percent").text(totalVotes ? ((gopVotes / totalVotes) * 100).toFixed(1) + "%" : "0%");
            d3.select("#dem-percent").text(totalVotes ? ((demVotes / totalVotes) * 100).toFixed(1) + "%" : "0%");
            d3.select("#reporting").text(((geojson.features.reduce((sum, f) => sum + (f.properties.reporting || 0), 0) / geojson.features.length).toFixed(1)) + "%");

            // Draw states
            svg.selectAll(".state")
                .data(geojson.features)
                .enter()
                .append("path")
                .attr("class", d => `state ${d.properties.winner || "Uncalled"}`)
                .attr("d", path)
                .on("mouseover", function(event, d) {
                    const props = d.properties;
                    const tooltip = d3.select("#tooltip");
                    tooltip.style("display", "block")
                        .html(`
                            <strong>${props.NAME}</strong><br>
                            GOP (Rockefeller): ${props.votes_gop.toLocaleString()} (${((props.votes_gop / props.total_votes) * 100).toFixed(1)}%)<br>
                            Democrat (Gephardt): ${props.votes_dem.toLocaleString()} (${((props.votes_dem / props.total_votes) * 100).toFixed(1)}%)<br>
                            Reporting: ${props.reporting.toFixed(1)}%<br>
                            Status: ${props.status}
                        `)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 10) + "px");
                })
                .on("mouseout", function() {
                    d3.select("#tooltip").style("display", "none");
                });
        }).catch(function(error) {
            console.error("Error loading GeoJSON:", error);
        });
    </script>
</body>
</html>
